// Ajaxify
// v1.0.1 - 30 September, 2012
// https://github.com/browserstate/ajaxify
(function(e,t){var n=e.History,r=e.jQuery,i=e.document;if(!n.enabled){return false}r(function(){var t="#content,article:first,.article:first,.post:first",s=r(t).filter(":first"),o=s.get(0),u=r("#menu,#nav,nav:first,.nav:first").filter(":first"),a="active selected current youarehere",f=".active,.selected,.current,.youarehere",l="> li,> ul > li",c="statechangecomplete",h=r(e),p=r(i.body),d=n.getRootUrl(),v={duration:800,easing:"swing"};if(s.length===0){s=p}r.expr[":"].internal=function(e,t,n,i){var s=r(e),o=s.attr("href")||"",u;u=o.substring(0,d.length)===d||o.indexOf(":")===-1;return u};var m=function(e){var t=String(e).replace(/<\!DOCTYPE[^>]*>/i,"").replace(/<(html|head|body|title|meta|script)([\s\>])/gi,'<div class="document-$1"$2').replace(/<\/(html|head|body|title|meta|script)\>/gi,"</div>");return r.trim(t)};r.fn.ajaxify=function(){var e=r(this);e.find("a:internal:not(.no-ajaxy)").click(function(e){var t=r(this),i=t.attr("href"),s=t.attr("title")||null;if(e.which==2||e.metaKey){return true}n.pushState(null,s,i);e.preventDefault();return false});return e};p.ajaxify();h.bind("statechange",function(){var g=n.getState(),y=g.url,b=y.replace(d,"");p.addClass("loading");s.animate({opacity:0},800);r.ajax({url:y,success:function(n,d,g){var w=r(m(n)),E=w.find(".document-body:first"),S=E.find(t).filter(":first"),x,T,N;N=S.find(".document-script");if(N.length){N.detach()}T=S.html()||w.html();if(!T){i.location.href=y;return false}x=u.find(l);x.filter(f).removeClass(a);x=x.has('a[href^="'+b+'"],a[href^="/'+b+'"],a[href^="'+y+'"]');if(x.length===1){x.addClass(a)}s.stop(true,true);s.html(T).ajaxify().css("opacity",100).show();i.title=w.find(".document-title:first").text();try{i.getElementsByTagName("title")[0].innerHTML=i.title.replace("<","&lt;").replace(">","&gt;").replace(" & "," & ")}catch(C){}N.each(function(){var e=r(this),t=e.text(),n=i.createElement("script");if(e.attr("src")){if(!e[0].async){n.async=false}n.src=e.attr("src")}n.appendChild(i.createTextNode(t));o.appendChild(n)});if(p.ScrollTo||false){p.ScrollTo(v)}p.removeClass("loading");h.trigger(c);if(typeof e._gaq!=="undefined"){e._gaq.push(["_trackPageview",b])}if(typeof e.reinvigorate!=="undefined"&&typeof e.reinvigorate.ajax_track!=="undefined"){reinvigorate.ajax_track(y)}},error:function(e,t,n){i.location.href=y;return false}})})})})(window)